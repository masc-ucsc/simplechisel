# hagent.yaml
profiles:
  - name: echo
    description: "Just print HAGENT_ environment variables"
    apis:
      - name: build_dir
        description: "Echo HAGENT_BUILD_DIR"
        command: "echo $HAGENT_BUILD_DIR"
        cwd: "$HAGENT_REPO_DIR"
      - name: repo_dir
        description: "Echo HAGENT_REPO_DIR"
        command: "echo $HAGENT_REPO_DIR"
        cwd: "$HAGENT_REPO_DIR"
  - name: gcd
    description: "Profile for building GCD module from Chisel/Scala sources"
    memory: 4  # in GB
    configuration:
      source: "track_repo_dir('src/main/scala', ext='.scala')"
      output: "track_build_dir('build_gcd', ext='.sv')"
      environment:
        SCALA_HOME: "/usr/local/scala"
        SBT_OPTS: "-Xmx2G -XX:+UseG1GC"
        PATH: "$PATH:/usr/local/scala/bin"
    apis:
      - name: compile
        description: "Compile GCD module and generate Verilog"
        command: "sbt \"runMain gcd.GCD\""
        cwd: "$HAGENT_REPO_DIR"
      - name: lint
        description: "Run scapegoat linting on Scala/Chisel code"
        command: "sbt scapegoat"
        cwd: "$HAGENT_REPO_DIR"
      - name: synth_fpga
        description: "FPGA synthesis GCD for Lattice using Yosys"
        command: "yosys -p 'read_verilog -sv build_gcd/*.sv; synth_lattice -family ecp5 -top GCD; write_json gcd_lattice.json'"
        cwd: "$HAGENT_BUILD_DIR"
      - name: synth_asic
        description: "ASIC synthesis GCD using Yosys"
        command: "/code/hagent/scripts/synth.py --run-sta --run-synth --tag reference --dir build_gcd --top GCD -- -F build_gcd/filelist.f"
        cwd: "$HAGENT_BUILD_DIR"
      - name: elab
        description: "Elaborate a module with hierarchy"
        command: "/code/hagent/scripts/synth.py --run-elab --tag reference --dir build_gcd --top GCD -- -F build_gcd/filelist.f"
        cwd: "$HAGENT_BUILD_DIR"

  - name: singlecyclecpu_nd
    description: "Profile for building Single Cycle CPU without debug from Chisel sources"
    memory: 4  # in GB
    configuration:
      source: "track_repo_dir('src/main/scala', ext='.scala')"
      output: "track_build_dir('build_singlecyclecpu_nd', ext='.sv')"
      environment:
        SCALA_HOME: "/usr/local/scala"
        SBT_OPTS: "-Xmx2G -XX:+UseG1GC"
        PATH: "$PATH:/usr/local/scala/bin"
    apis:
      - name: compile
        description: "Compile Single Cycle CPU (No Debug) and generate Verilog"
        command: "sbt \"runMain dinocpu.SingleCycleCPUNoDebug\""
        cwd: "$HAGENT_REPO_DIR"
      - name: lint
        description: "Run scapegoat linting on Scala/Chisel code"
        command: "sbt scapegoat"
        cwd: "$HAGENT_REPO_DIR"
      - name: synth_fpga
        description: "FPGA synthesis of Single Cycle CPU for Lattice using Yosys"
        command: "yosys -p 'read_verilog -sv build_singlecyclecpu_nd/*.sv; synth_lattice -family ecp5 -top SingleCycleCPU; write_json singlecpu_nd_lattice.json'"
        cwd: "$HAGENT_BUILD_DIR"
      - name: synth_asic
        description: "ASIC synthesis Single Cycle CPU using Yosys"
        command: "/code/hagent/scripts/synth.py --run-sta --run-synth --tag reference --dir build_singlecyclecpu_nd {{top}} {{top_synth}} -- -F build_singlecyclecpu_nd/filelist.f"
        cwd: "$HAGENT_BUILD_DIR"
        options:
          - name: top_synth
            description: "Optional top synthesis module for faster synthesis that avoids top elaboration"
            format: "--top-synthesis {value}"
            default: ""
          - name: top
            description: "Top module for elaboration"
            format: "--top {value}"
            default: "--top SingleCycleCPU"
      - name: elab
        description: "Elaborate Single Cycle CPU using Yosys"
        command: "/code/hagent/scripts/synth.py --run-elab --tag reference --dir build_singlecyclecpu_nd {{top}} {{top_synth}} -- -F build_singlecyclecpu_nd/filelist.f"
        cwd: "$HAGENT_BUILD_DIR"
        options:
          - name: top_synth
            description: "Optional top synthesis module for faster synthesis that avoids top elaboration"
            format: "--top-synthesis {value}"
            default: ""
          - name: top
            description: "Top module for elaboration"
            format: "--top {value}"
            default: "--top SingleCycleCPU"

  - name: singlecyclecpu_d
    description: "Profile for building Single Cycle CPU with debug from Chisel sources"
    memory: 4  # in GB
    configuration:
      source: "track_repo_dir('src/main/scala', ext='.scala')"
      output: "track_build_dir('build_singlecyclecpu_d', ext='.sv')"
      environment:
        SCALA_HOME: "/usr/local/scala"
        SBT_OPTS: "-Xmx2G -XX:+UseG1GC"
        PATH: "$PATH:/usr/local/scala/bin"
    apis:
      - name: compile
        description: "Compile Single Cycle CPU (Debug) and generate Verilog"
        command: "sbt \"runMain dinocpu.SingleCycleCPUDebug\""
        cwd: "$HAGENT_REPO_DIR"
      - name: lint
        description: "Run scapegoat linting on Scala/Chisel code"
        command: "sbt scapegoat"
        cwd: "$HAGENT_REPO_DIR"
      - name: synth_fpga
        description: "FPGA synthesis Single Cycle CPU Debug for FPGA using Yosys"
        command: "yosys -p 'read_verilog -sv build_singlecyclecpu_d/*.sv; synth_lattice -family ecp5 -top SingleCycleCPU; write_json singlecpu_d_lattice.json'"
        cwd: "$HAGENT_REPO_DIR"
      - name: synth_asic
        description: "ASIC synthesis Single Cycle CPU Debug using Yosys"
        command: "/code/hagent/scripts/synth.py {{top}} {{top_synth}} --run-sta --run-synth --tag reference --dir build_singlecyclecpu_d -- -F build_singlecyclecpu_d/filelist.f"
        cwd: "$HAGENT_BUILD_DIR"
        options:
          - name: top_synth
            description: "Optional top synthesis module for faster synthesis that avoids top elaboration"
            format: "--top-synthesis {value}"
            default: ""
          - name: top
            description: "Top module for elaboration"
            format: "--top {value}"
            default: "--top SingleCycleCPU"
      - name: elab
        description: "Elaborate Single Cycle CPU Debug using Yosys"
        command: "/code/hagent/scripts/synth.py {{top}} {{top_synth}} --run-elab --tag reference --dir build_singlecyclecpu_d -- -F build_singlecyclecpu_d/filelist.f"
        cwd: "$HAGENT_BUILD_DIR"
        options:
          - name: top_synth
            description: "Optional top synthesis module for faster synthesis that avoids top elaboration"
            format: "--top-synthesis {value}"
            default: ""
          - name: top
            description: "Top module for elaboration"
            format: "--top {value}"
            default: "--top SingleCycleCPU"

  - name: pipelined_d
    description: "Profile for building Pipelined Single Issue CPU with debug"
    memory: 4  # in GB
    configuration:
      source: "track_repo_dir('src/main/scala', ext='.scala')"
      output: "track_build_dir('build_pipelined_d', ext='.sv')"
      environment:
        SCALA_HOME: "/usr/local/scala"
        SBT_OPTS: "-Xmx2G -XX:+UseG1GC"
        PATH: "$PATH:/usr/local/scala/bin"
    apis:
      - name: compile
        description: "Compile Pipelined Single Issue CPU (Debug) and generate Verilog"
        command: "sbt \"runMain dinocpu.pipelined.PipelinedDebug\""
        cwd: "$HAGENT_REPO_DIR"
      - name: lint
        description: "Run scapegoat linting on Scala/Chisel code"
        command: "sbt scapegoat"
        cwd: "$HAGENT_REPO_DIR"
      - name: synth_fpga
        description: "FPGA synthesis Pipelined Single Issue CPU Debug for Lattice using Yosys"
        command: "yosys -p 'read_verilog -sv build_pipelined_d/*.sv; synth_lattice -family ecp5 -top PipelinedCPU; write_json pipelined_d_lattice.json'"
        cwd: "$HAGENT_REPO_DIR"
      - name: synth_asic
        description: "ASIC synthesis Pipelined Single Issue CPU Debug using Yosys"
        command: "/code/hagent/scripts/synth.py --run-sta --run-synth {{top}} {{top_synth}} --tag reference --dir build_pipelined_d -- -F build_pipelined_d/filelist.f"
        cwd: "$HAGENT_BUILD_DIR"
        options:
          - name: top_synth
            description: "Optional top synthesis module for faster synthesis that avoids top elaboration"
            format: "--top-synthesis {value}"
            default: ""
          - name: top
            description: "Top module for elaboration"
            format: "--top {value}"
            default: "--top PipelinedCPU"
      - name: elab
        description: "Elaborate Pipelined Single Issue CPU Debug using Yosys"
        command: "/code/hagent/scripts/synth.py --run-elab {{top}} {{top_synth}} --tag reference --dir build_pipelined_d -- -F build_pipelined_d/filelist.f"
        cwd: "$HAGENT_BUILD_DIR"
        options:
          - name: top_synth
            description: "Optional top synthesis module for faster synthesis that avoids top elaboration"
            format: "--top-synthesis {value}"
            default: ""
          - name: top
            description: "Top module for elaboration"
            format: "--top {value}"
            default: "--top PipelinedCPU"

  - name: pipelined_nd
    description: "Profile for building Pipelined Single Issue CPU without debug"
    memory: 4  # in GB
    configuration:
      source: "track_repo_dir('src/main/scala', ext='.scala')"
      output: "track_build_dir('build_pipelined_nd', ext='.sv')"
      environment:
        SCALA_HOME: "/usr/local/scala"
        SBT_OPTS: "-Xmx2G -XX:+UseG1GC"
        PATH: "$PATH:/usr/local/scala/bin"
    apis:
      - name: compile
        description: "Compile Pipelined Single Issue CPU (No Debug) and generate Verilog"
        command: "sbt \"runMain dinocpu.pipelined.PipelinedNoDebug\""
        cwd: "$HAGENT_REPO_DIR"
      - name: lint
        description: "Run scapegoat linting on Scala/Chisel code"
        command: "sbt scapegoat"
        cwd: "$HAGENT_REPO_DIR"
      - name: synth_fpga
        description: "FPGA synthesis Pipelined CPU for Lattice using Yosys"
        command: "yosys -p 'read_verilog -sv build_pipelined_nd/*.sv; synth_lattice -family ecp5 -top PipelinedCPU; write_json pipelined_nd_lattice.json'"
        cwd: "$HAGENT_REPO_DIR"
      - name: synth_asic
        description: "ASIC synthesis Pipelined Single Issue CPU using Yosys"
        command: "/code/hagent/scripts/synth.py --run-sta --run-synth {{top}} {{top_synth}} --tag reference --dir build_pipelined_nd -- -F build_pipelined_nd/filelist.f"
        cwd: "$HAGENT_BUILD_DIR"
        options:
          - name: top_synth
            description: "Optional top synthesis module for faster synthesis that avoids top elaboration"
            format: "--top-synthesis {value}"
            default: ""
          - name: top
            description: "Top module for elaboration"
            format: "--top {value}"
            default: "--top PipelinedCPU"
      - name: elab
        description: "Elaborate Pipelined Single Issue CPU using Yosys"
        command: "/code/hagent/scripts/synth.py --run-elab {{top}} {{top_synth}} --tag reference --dir build_pipelined_nd -- -F build_pipelined_nd/filelist.f"
        cwd: "$HAGENT_BUILD_DIR"
        options:
          - name: top_synth
            description: "Optional top synthesis module for faster synthesis that avoids top elaboration"
            format: "--top-synthesis {value}"
            default: ""
          - name: top
            description: "Top module for elaboration"
            format: "--top {value}"
            default: "--top PipelinedCPU"

  - name: dualissue_d
    description: "Profile for building Pipelined Dual Issue CPU with debug"
    memory: 4  # in GB
    configuration:
      source: "track_repo_dir('src/main/scala', ext='.scala')"
      output: "track_build_dir('build_dualissue_d', ext='.sv')"
      environment:
        SCALA_HOME: "/usr/local/scala"
        SBT_OPTS: "-Xmx2G -XX:+UseG1GC"
        PATH: "$PATH:/usr/local/scala/bin"
    apis:
      - name: compile
        description: "Compile Pipelined Dual Issue CPU (Debug) and generate Verilog"
        command: "sbt \"runMain dinocpu.pipelined.PipelinedDualIssueDebug\""
        cwd: "$HAGENT_REPO_DIR"
      - name: lint
        description: "Run scapegoat linting on Scala/Chisel code"
        command: "sbt scapegoat"
        cwd: "$HAGENT_REPO_DIR"
      - name: synth_fpga
        description: "FPGA synthesis Pipelined Dual Issue CPU Debug for Lattice using Yosys"
        command: "yosys -p 'read_verilog -sv build_dualissue_d/*.sv; synth_lattice -family ecp5 -top PipelinedDualIssueCPU; write_json pipelined_d_lattice.json'"
        cwd: "$HAGENT_REPO_DIR"
      - name: synth_asic
        description: "ASIC synthesis Pipelined Dual Issue CPU Debug using Yosys"
        command: "/code/hagent/scripts/synth.py --run-sta --run-synth {{top}} {{top_synth}} --tag reference --dir build_dualissue_d -- -F build_dualissue_d/filelist.f"
        cwd: "$HAGENT_BUILD_DIR"
        options:
          - name: top_synth
            description: "Optional top synthesis module for faster synthesis that avoids top elaboration"
            format: "--top-synthesis {value}"
            default: ""
          - name: top
            description: "Top module for elaboration"
            format: "--top {value}"
            default: "--top PipelinedDualIssueCPU"
      - name: elab
        description: "Elaboration Pipelined Dual Issue CPU Debug using Yosys"
        command: "/code/hagent/scripts/synth.py --run-elab {{top}} {{top_synth}} --tag reference --dir build_dualissue_d -- -F build_dualissue_d/filelist.f"
        cwd: "$HAGENT_BUILD_DIR"
        options:
          - name: top_synth
            description: "Optional top synthesis module for faster synthesis that avoids top elaboration"
            format: "--top-synthesis {value}"
            default: ""
          - name: top
            description: "Top module for elaboration"
            format: "--top {value}"
            default: "--top PipelinedDualIssueCPU"

  - name: dualissue_nd
    description: "Profile for building Pipelined Dual Issue CPU without debug"
    memory: 4  # in GB
    configuration:
      source: "track_repo_dir('src/main/scala', ext='.scala')"
      output: "track_build_dir('build_dualissue_nd', ext='.sv')"
      environment:
        SCALA_HOME: "/usr/local/scala"
        SBT_OPTS: "-Xmx2G -XX:+UseG1GC"
        PATH: "$PATH:/usr/local/scala/bin"
    apis:
      - name: compile
        description: "Compile Pipelined Dual Issue CPU (No Debug) and generate Verilog"
        command: "sbt \"runMain dinocpu.pipelined.PipelinedDualIssueNoDebug\""
        cwd: "$HAGENT_REPO_DIR"
      - name: lint
        description: "Run scapegoat linting on Scala/Chisel code"
        command: "sbt scapegoat"
        cwd: "$HAGENT_REPO_DIR"
      - name: synth_fpga
        description: "FPGA synthesis Pipelined CPU for Lattice using Yosys"
        command: "yosys -p 'read_verilog -sv build_dualissue_nd/*.sv; synth_lattice -family ecp5 -top PipelinedDualIssueCPU; write_json dualissue_nd_lattice.json'"
        cwd: "$HAGENT_REPO_DIR"
      - name: synth_asic
        description: "ASIC synthesis Pipelined Dual Issue CPU using Yosys"
        command: "/code/hagent/scripts/synth.py --run-sta --run-synth {{top}} {{top_synth}} --tag reference --dir build_dualissue_nd -- -F build_dualissue_nd/filelist.f"
        cwd: "$HAGENT_BUILD_DIR"
        options:
          - name: top_synth
            description: "Optional top synthesis module for faster synthesis that avoids top elaboration"
            format: "--top-synthesis {value}"
            default: ""
          - name: top
            description: "Top module for elaboration"
            format: "--top {value}"
            default: "--top PipelinedDualIssueCPU"
      - name: elab
        description: "Elaborate Pipelined Dual Issue CPU using Yosys"
        command: "/code/hagent/scripts/synth.py --run-elab {{top}} {{top_synth}} --tag reference --dir build_dualissue_nd -- -F build_dualissue_nd/filelist.f"
        cwd: "$HAGENT_BUILD_DIR"
        options:
          - name: top_synth
            description: "Optional top synthesis module for faster synthesis that avoids top elaboration"
            format: "--top-synthesis {value}"
            default: ""
          - name: top
            description: "Top module for elaboration"
            format: "--top {value}"
            default: "--top PipelinedDualIssueCPU"
